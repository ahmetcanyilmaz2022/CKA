#  Deployment: resimler
apiVersion: apps/v1
kind: Deployment
metadata:
  name: resimler
spec:
  replicas: 1
  selector:
    matchLabels:
      app: resimler
  template:
    metadata:
      labels:
        app: resimler
    spec:
      containers:
      - name: resimler
        image: ahmetcan2022/resimler-site:v2   # ğŸ“¦ Resimler sayfasÄ± iÃ§in Docker imajÄ±
        ports:
        - containerPort: 80                    # ğŸŒ Nginx varsayÄ±lan portu

---

# Service: resimler
apiVersion: v1
kind: Service
metadata:
  name: resimler
spec:
  selector:
    app: resimler
  ports:
    - protocol: TCP
      port: 80           # ğŸ’¡ Servisin Kubernetes iÃ§inde dinlediÄŸi port
      targetPort: 80     # ğŸ¯ Container iÃ§indeki hedef port
  type: ClusterIP        # ğŸ”’ Klasik servis tipi (podâ€™lar arasÄ± eriÅŸim iÃ§in)

---

#  Deployment: videolar
apiVersion: apps/v1
kind: Deployment
metadata:
  name: videolar
spec:
  replicas: 1
  selector:
    matchLabels:
      app: videolar
  template:
    metadata:
      labels:
        app: videolar
    spec:
      containers:
      - name: videolar
        image: ahmetcan2022/videolar-site      #  Videolar sayfasÄ± iÃ§in Docker imajÄ±
        ports:
        - containerPort: 80                    #  Apache/Nginx portu

---

#  Service: videolar
apiVersion: v1
kind: Service
metadata:
  name: videolar
spec:
  selector:
    app: videolar
  ports:
    - protocol: TCP
      port: 80           #  Servisin cluster iÃ§indeki portu
      targetPort: 80     #  Container iÃ§indeki port
  type: ClusterIP        #  Ä°Ã§ eriÅŸim iÃ§in uygun servis tipi

---

#  Ingress: path rewrite destekli
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: multi-path-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /    #  URLâ€™deki /resimler veya /videolar kÄ±smÄ±nÄ± / olarak yÃ¶nlendir
spec:
  ingressClassName: nginx                            #  KullanÄ±lan Ingress Controller (Ã¶rneÄŸin: ingress-nginx)
  rules:
  - host: localhost                                  #  TarayÄ±cÄ±da kullanÄ±lacak hostname (Ã¶rneÄŸin: http://localhost)
    http:
      paths:
      - path: /resimler                              #  /resimler pathâ€™i geldiÄŸinde aÅŸaÄŸÄ±daki servise yÃ¶nlendir
        pathType: Prefix                             #  /resimler ve alt path'lerini eÅŸleÅŸtir (/resimler/abc gibi)
        backend:
          service:
            name: resimler                           #  YÃ¶nlendirilecek servis adÄ±
            port:
              number: 80                             #  Servisin portu
      - path: /videolar                              #  /videolar pathâ€™i geldiÄŸinde aÅŸaÄŸÄ±daki servise yÃ¶nlendir
        pathType: Prefix
        backend:
          service:
            name: videolar
            port:
              number: 80




#kubectl create ingress multi-path-ingress \
# --class=nginx \
# --rule="/resimler=resimler:80" \
# --rule="/videolar=videolar:80" \
# --annotation="nginx.ingress.kubernetes.io/rewrite-target=/"
